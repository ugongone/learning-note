<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAGAS 評価指標ガイド</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f8fafc;
        }
        .metric-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-10">
        <div class="container mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
                <h1 class="text-xl font-bold text-slate-900">RAGAS 評価指標ガイド</h1>
            </div>
            <span class="text-sm font-medium text-slate-500 bg-slate-100 px-3 py-1 rounded-full">RAG Assessment Framework</span>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 max-w-5xl">

        <!-- Introduction -->
        <section class="mb-12 text-center">
            <h2 class="text-3xl font-bold mb-4 text-slate-900">RAGパイプラインの品質を測る4つの柱</h2>
            <p class="text-lg text-slate-600 max-w-3xl mx-auto">
                RAGAS（Retrieval Augmented Generation Assessment）では、<br class="hidden sm:inline">
                <span class="text-indigo-600 font-bold">「生成 (Generation)」</span>と<span class="text-emerald-600 font-bold">「検索 (Retrieval)」</span>の2つの側面からRAGの精度を評価します。
            </p>
        </section>

        <!-- Generation Metrics Section -->
        <section class="mb-12">
            <div class="flex items-center gap-3 mb-6">
                <div class="p-2 bg-indigo-100 rounded-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-slate-900">1. 回答生成精度評価 (Generation Metrics)</h2>
            </div>
            
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Faithfulness -->
                <article class="metric-card bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden flex flex-col h-full">
                    <div class="h-2 bg-indigo-500"></div>
                    <div class="p-6 flex-1 flex flex-col">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="text-xl font-bold text-slate-800">Faithfulness <span class="text-sm font-normal text-slate-500 ml-2">(忠実性)</span></h3>
                            <span class="bg-indigo-50 text-indigo-700 text-xs px-2 py-1 rounded border border-indigo-100">対ハルシネーション</span>
                        </div>
                        
                        <div class="space-y-4 flex-1">
                            <div>
                                <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">概要</h4>
                                <p class="text-slate-600 text-sm leading-relaxed">
                                    生成された回答が、検索された<span class="font-bold text-indigo-600 bg-indigo-50 px-1 rounded">コンテキストの情報のみに基づいているか</span>を評価します。
                                </p>
                            </div>

                            <!-- Example -->
                            <div class="p-3 bg-yellow-50 rounded-lg border border-yellow-100">
                                <h4 class="text-xs font-bold text-yellow-700 uppercase tracking-wider mb-2">具体例</h4>
                                <div class="text-xs space-y-2">
                                    <div class="flex gap-2">
                                        <span class="font-bold text-slate-500 min-w-[3.5em]">Context:</span>
                                        <span class="text-slate-700">「東京タワーは333mです。」</span>
                                    </div>
                                    <div class="flex gap-2">
                                        <span class="font-bold text-indigo-600 min-w-[3.5em]">High:</span>
                                        <span class="text-slate-700">「東京タワーの高さは333mです。」</span>
                                    </div>
                                    <div class="flex gap-2">
                                        <span class="font-bold text-rose-500 min-w-[3.5em]">Low:</span>
                                        <span class="text-slate-700">「東京タワーは333mで、<span class="font-bold underline decoration-rose-300">日本一高い</span>です。」</span>
                                    </div>
                                    <p class="text-xs text-slate-500 italic mt-1 ml-[4em] leading-tight">※「日本一高い」はコンテキストに存在しないため減点</p>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4 bg-slate-50 p-3 rounded-lg border border-slate-100">
                            <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">評価ロジック</h4>
                            <p class="text-xs text-slate-500 font-mono">
                                回答から「主張」を抽出 &rarr; 各主張がコンテキストから推論可能か判定
                            </p>
                        </div>
                    </div>
                </article>

                <!-- Answer Relevance -->
                <article class="metric-card bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden flex flex-col h-full">
                    <div class="h-2 bg-indigo-500"></div>
                    <div class="p-6 flex-1 flex flex-col">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="text-xl font-bold text-slate-800">Answer Relevance <span class="text-sm font-normal text-slate-500 ml-2">(回答の関連性)</span></h3>
                            <span class="bg-indigo-50 text-indigo-700 text-xs px-2 py-1 rounded border border-indigo-100">対・的外れな回答</span>
                        </div>
                        
                        <div class="space-y-4 flex-1">
                            <div>
                                <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">概要</h4>
                                <p class="text-slate-600 text-sm leading-relaxed">
                                    生成された回答が、<span class="font-bold text-indigo-600 bg-indigo-50 px-1 rounded">ユーザーの質問に対して適切に関連しているか</span>を評価します。
                                </p>
                            </div>

                            <!-- Example -->
                            <div class="p-3 bg-yellow-50 rounded-lg border border-yellow-100">
                                <h4 class="text-xs font-bold text-yellow-700 uppercase tracking-wider mb-2">具体例</h4>
                                <div class="text-xs space-y-2">
                                    <div class="flex gap-2">
                                        <span class="font-bold text-slate-500 min-w-[3.5em]">Q:</span>
                                        <span class="text-slate-700">「フランスの首都は？」</span>
                                    </div>
                                    <div class="flex gap-2">
                                        <span class="font-bold text-indigo-600 min-w-[3.5em]">High:</span>
                                        <span class="text-slate-700">「パリです。」</span>
                                    </div>
                                    <div class="flex gap-2">
                                        <span class="font-bold text-rose-500 min-w-[3.5em]">Low:</span>
                                        <span class="text-slate-700">「フランスは<span class="font-bold underline decoration-rose-300">ワインが有名</span>です。」</span>
                                    </div>
                                    <p class="text-xs text-slate-500 italic mt-1 ml-[4em] leading-tight">※事実は正しいが、質問に答えていないため減点</p>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4 bg-slate-50 p-3 rounded-lg border border-slate-100">
                            <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">評価ロジック</h4>
                            <p class="text-xs text-slate-500 font-mono">
                                回答から「質問」を逆生成 &rarr; 元の質問との類似度(Cosine Similarity)計算
                            </p>
                        </div>
                    </div>
                </article>
            </div>
        </section>

        <!-- Retrieval Metrics Section -->
        <section class="mb-12">
            <div class="flex items-center gap-3 mb-6">
                <div class="p-2 bg-emerald-100 rounded-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-emerald-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-slate-900">2. 検索精度評価 (Retrieval Metrics)</h2>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
                <!-- Context Precision -->
                <article class="metric-card bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden flex flex-col h-full">
                    <div class="h-2 bg-emerald-500"></div>
                    <div class="p-6 flex-1 flex flex-col">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="text-xl font-bold text-slate-800">Context Precision <span class="text-sm font-normal text-slate-500 ml-2">(適合率)</span></h3>
                            <span class="bg-emerald-50 text-emerald-700 text-xs px-2 py-1 rounded border border-emerald-100">検索ノイズ・ランク品質</span>
                        </div>
                        
                        <div class="space-y-4 flex-1">
                            <div>
                                <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">概要</h4>
                                <p class="text-slate-600 text-sm leading-relaxed">
                                    検索結果の中で、<span class="font-bold text-emerald-600 bg-emerald-50 px-1 rounded">正解に関連する情報がどれだけ上位にあるか</span>を評価します。
                                </p>
                            </div>

                            <!-- Example -->
                            <div class="p-3 bg-yellow-50 rounded-lg border border-yellow-100">
                                <h4 class="text-xs font-bold text-yellow-700 uppercase tracking-wider mb-2">具体例: 「リンゴの色は？」</h4>
                                <div class="text-xs space-y-2">
                                    <div class="flex gap-2">
                                        <span class="font-bold text-indigo-600 min-w-[3.5em]">High:</span>
                                        <div class="flex flex-col">
                                            <span>1. リンゴは赤い <span class="text-emerald-600 font-bold">(正解)</span></span>
                                            <span class="text-slate-400">2. バナナは黄色</span>
                                        </div>
                                    </div>
                                    <div class="flex gap-2 border-t border-yellow-200 pt-2 mt-1">
                                        <span class="font-bold text-rose-500 min-w-[3.5em]">Low:</span>
                                        <div class="flex flex-col">
                                            <span class="text-slate-400">1. バナナは黄色</span>
                                            <span>2. リンゴは赤い <span class="text-emerald-600 font-bold">(正解)</span></span>
                                        </div>
                                    </div>
                                    <p class="text-xs text-slate-500 italic mt-1 ml-[4em] leading-tight">※正解チャンクの順位が低いと減点</p>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4 bg-slate-50 p-3 rounded-lg border border-slate-100">
                            <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">評価ロジック</h4>
                            <p class="text-xs text-slate-500 font-mono">
                                Ground Truthに関連する情報の検索リスト内でのランクと密度を計算
                            </p>
                        </div>
                    </div>
                </article>

                <!-- Context Recall -->
                <article class="metric-card bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden flex flex-col h-full">
                    <div class="h-2 bg-emerald-500"></div>
                    <div class="p-6 flex-1 flex flex-col">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="text-xl font-bold text-slate-800">Context Recall <span class="text-sm font-normal text-slate-500 ml-2">(再現率)</span></h3>
                            <span class="bg-emerald-50 text-emerald-700 text-xs px-2 py-1 rounded border border-emerald-100">検索漏れ防止</span>
                        </div>
                        
                        <div class="space-y-4 flex-1">
                            <div>
                                <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">概要</h4>
                                <p class="text-slate-600 text-sm leading-relaxed">
                                    正解を導くために<span class="font-bold text-emerald-600 bg-emerald-50 px-1 rounded">必要な情報が全てコンテキストに含まれているか</span>を評価します。
                                </p>
                            </div>

                            <!-- Example -->
                            <div class="p-3 bg-yellow-50 rounded-lg border border-yellow-100">
                                <h4 class="text-xs font-bold text-yellow-700 uppercase tracking-wider mb-2">具体例</h4>
                                <div class="text-xs space-y-2">
                                    <div class="flex gap-2">
                                        <span class="font-bold text-slate-500 min-w-[3.5em]">正解:</span>
                                        <span class="text-slate-700">「家康は<span class="font-bold text-indigo-600">1603年</span>に<span class="font-bold text-indigo-600">江戸幕府</span>を開いた」</span>
                                    </div>
                                    <div class="flex gap-2 border-t border-yellow-200 pt-2 mt-1">
                                        <span class="font-bold text-rose-500 min-w-[3.5em]">Low:</span>
                                        <span class="text-slate-700">「家康は江戸幕府を開いた」のみ取得。<br>「1603年」が<span class="font-bold text-rose-500">欠落</span>している。</span>
                                    </div>
                                    <p class="text-xs text-slate-500 italic mt-1 ml-[4em] leading-tight">※正解作成に必要な情報が不足しているため減点</p>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4 bg-slate-50 p-3 rounded-lg border border-slate-100">
                            <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">評価ロジック</h4>
                            <p class="text-xs text-slate-500 font-mono">
                                Ground Truthの各文がコンテキストに基づいているか判定
                            </p>
                        </div>
                    </div>
                </article>
            </div>
        </section>

        <!-- Summary Table -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold text-slate-900 mb-6">比較まとめ</h2>
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-slate-50 border-b border-slate-200">
                                <th class="p-4 text-sm font-bold text-slate-600">カテゴリ</th>
                                <th class="p-4 text-sm font-bold text-slate-600">指標名</th>
                                <th class="p-4 text-sm font-bold text-slate-600">比較対象</th>
                                <th class="p-4 text-sm font-bold text-slate-600">チェックポイント</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100">
                            <tr class="hover:bg-slate-50 transition-colors">
                                <td class="p-4 text-sm font-medium text-indigo-600">生成評価</td>
                                <td class="p-4 font-bold text-slate-800">Faithfulness</td>
                                <td class="p-4 text-sm text-slate-600">回答 vs コンテキスト</td>
                                <td class="p-4 text-sm text-slate-600">嘘をついていないか？（ハルシネーション）</td>
                            </tr>
                            <tr class="hover:bg-slate-50 transition-colors">
                                <td class="p-4 text-sm font-medium text-indigo-600">生成評価</td>
                                <td class="p-4 font-bold text-slate-800">Answer Relevance</td>
                                <td class="p-4 text-sm text-slate-600">回答 vs 質問</td>
                                <td class="p-4 text-sm text-slate-600">質問の意図に沿って答えているか？</td>
                            </tr>
                            <tr class="hover:bg-slate-50 transition-colors">
                                <td class="p-4 text-sm font-medium text-emerald-600">検索評価</td>
                                <td class="p-4 font-bold text-slate-800">Context Precision</td>
                                <td class="p-4 text-sm text-slate-600">コンテキスト vs 正解</td>
                                <td class="p-4 text-sm text-slate-600">関連情報は上位にあるか？（ノイズ除去）</td>
                            </tr>
                            <tr class="hover:bg-slate-50 transition-colors">
                                <td class="p-4 text-sm font-medium text-emerald-600">検索評価</td>
                                <td class="p-4 font-bold text-slate-800">Context Recall</td>
                                <td class="p-4 text-sm text-slate-600">コンテキスト vs 正解</td>
                                <td class="p-4 text-sm text-slate-600">必要な情報は揃っているか？（網羅性）</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Concept Diagram (Moved) -->
        <section class="mb-16 bg-white p-6 rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
            <h3 class="text-lg font-bold text-slate-700 mb-6 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 00-1-1H3zm11 4a1 1 0 10-2 0v4a1 1 0 102 0V7zm-3 1a1 1 0 10-2 0v3a1 1 0 102 0V8zM8 9a1 1 0 00-2 0v2a1 1 0 102 0V9z" clip-rule="evenodd" /></svg>
                評価指標の関係図
            </h3>
            
            <!-- SVG Diagram -->
            <div class="relative w-full aspect-[16/7] min-h-[300px] select-none">
                <svg class="w-full h-full" viewBox="0 0 800 350" xmlns="http://www.w3.org/2000/svg">
                    <!-- Definitions -->
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#94a3b8" />
                        </marker>
                    </defs>

                    <!-- Areas Background -->
                    <!-- Retrieval Area -->
                    <rect x="10" y="10" width="380" height="330" rx="15" fill="#f0fdf4" stroke="#86efac" stroke-width="1" stroke-dasharray="4"/>
                    <text x="30" y="40" font-weight="bold" fill="#15803d" font-size="14">検索評価 (Retrieval)</text>

                    <!-- Generation Area -->
                    <rect x="410" y="10" width="380" height="330" rx="15" fill="#eff6ff" stroke="#93c5fd" stroke-width="1" stroke-dasharray="4"/>
                    <text x="430" y="40" font-weight="bold" fill="#1d4ed8" font-size="14">生成評価 (Generation)</text>

                    <!-- Nodes -->
                    <!-- Retrieval Side -->
                    <g transform="translate(50, 150)">
                        <rect x="0" y="0" width="100" height="50" rx="8" fill="white" stroke="#cbd5e1" stroke-width="2"/>
                        <text x="50" y="30" text-anchor="middle" font-weight="bold" fill="#334155" font-size="14">Question</text>
                    </g>

                    <g transform="translate(250, 150)">
                        <rect x="0" y="0" width="100" height="50" rx="8" fill="white" stroke="#cbd5e1" stroke-width="2"/>
                        <text x="50" y="30" text-anchor="middle" font-weight="bold" fill="#334155" font-size="14">Contexts</text>
                    </g>
                    
                    <g transform="translate(250, 250)">
                        <rect x="0" y="0" width="100" height="50" rx="8" fill="#f1f5f9" stroke="#94a3b8" stroke-width="2" stroke-dasharray="4"/>
                        <text x="50" y="30" text-anchor="middle" font-weight="bold" fill="#64748b" font-size="13">Ground Truth</text>
                    </g>

                    <!-- Generation Side -->
                    <!-- Answer moved to center of Generation area (approx x=550) -->
                    <g transform="translate(550, 150)">
                        <rect x="0" y="0" width="100" height="50" rx="8" fill="white" stroke="#cbd5e1" stroke-width="2"/>
                        <text x="50" y="30" text-anchor="middle" font-weight="bold" fill="#334155" font-size="14">Answer</text>
                    </g>

                    <!-- Base Arrows -->
                    <line x1="150" y1="175" x2="240" y2="175" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrowhead)"/>
                    <!-- Contexts -> Answer arrow extended to new position -->
                    <line x1="350" y1="175" x2="540" y2="175" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrowhead)"/>
                    
                    <!-- Metric Connectors & Labels -->
                    
                    <!-- Context Precision/Recall -->
                    <path d="M 300 200 L 300 250" stroke="#16a34a" stroke-width="2" stroke-dasharray="4"/>
                    <rect x="210" y="210" width="80" height="30" rx="4" fill="#dcfce7" stroke="#16a34a"/>
                    <text x="250" y="229" text-anchor="middle" fill="#166534" font-size="11" font-weight="bold">Context</text>
                    <text x="250" y="260" text-anchor="middle" fill="#166534" font-size="10">Precision / Recall</text>

                    <!-- Faithfulness -->
                    <!-- Curve stretched to reach x=550. Peak adjusted to approx x=450 -->
                    <path d="M 300 150 Q 450 100 600 150" fill="none" stroke="#2563eb" stroke-width="2" stroke-dasharray="4"/>
                    <!-- Label moved "below" the line -->
                    <rect x="430" y="130" width="80" height="24" rx="4" fill="#dbeafe" stroke="#2563eb"/>
                    <text x="470" y="146" text-anchor="middle" fill="#1e40af" font-size="11" font-weight="bold">Faithfulness</text>

                    <!-- Answer Relevance -->
                    <!-- Curve stretched significantly to reach x=550. Peak x=350 -->
                    <path d="M 100 150 Q 350 20 600 150" fill="none" stroke="#2563eb" stroke-width="2" stroke-dasharray="4"/>
                    <!-- Label moved "right side lower" to x=460 y=60 -->
                    <rect x="460" y="60" width="100" height="24" rx="4" fill="#dbeafe" stroke="#2563eb"/>
                    <text x="510" y="76" text-anchor="middle" fill="#1e40af" font-size="11" font-weight="bold">Answer Relevance</text>

                </svg>
            </div>
        </section>

        <footer class="text-center text-slate-400 text-sm py-8 border-t border-slate-200 mt-8">
            <p>Generated by Gemini &middot; RAGAS Metrics Visualization</p>
        </footer>

    </main>
</body>
</html>